<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Log</title>
    <link rel="stylesheet" href="./css/materialize.min.css">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="./css/app.css">
    <script type="text/javascript" src="./js/materialize.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.3.0/firebase.js"></script>
    <link rel="manifest" href="./manifest.json">
</head>

<body>
    <nav>
        <div class="nav-wrapper container">
            <p>Movie Log</p>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li class="logged-in"><a href="#" class="waves-effect modal-trigger" data-target="modal-account">Account</a></li>
                <li class="logged-out"><a href="#" class="waves-effect modal-trigger" data-target="modal-signup">Sign up</a></li>
                <li class="logged-out"><a href="#" class="waves-effect modal-trigger" data-target="modal-login">Login</a></li>
                <li class="logged-in"><a href="#" class="waves-effect" id="logout">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Movies -->
    <div class="movies container grey-text text-darken-1">

    </div>

    <div class="center">
        <a class="btn-floating btn-small btn-large add-btn sidenav-trigger" data-target="side-form">
            <i class="material-icons">add</i>
        </a>
    </div>

    <div id="side-form" class="sidenav side-form">
        <form class="add-movie container section">
            <h6>New Movie</h6>
            <div class="divider"></div>
            <div class="input-field">
                <input placeholder="Enter Movie Title" id="title" class="validate" type="text">
                <label for="title">Movie Title</label>
            </div>
            <div class="input-field">
                <input placeholder="Enter Movie Synopsis" id="synopsis" class="validate" type="text">
                <label for="synopsis">Movie Synopsis</label>
            </div>

            <div class="input-field center">
                <button class="btn-small" id="add">Add</button>
            </div>
    </div>
    </form>

    <!-- Sign Up Modal -->
    <div id="modal-signup" class="modal">
        <div class="modal-content">
            <h4>Sign up</h4><br />
            <form id="signup-form">
                <div class="input-field">
                    <input type="email" id="signup-email" required />
                    <label for="signup-email">Email address</label>
                </div>
                <div class="input-field">
                    <input type="password" id="signup-password" required />
                    <label for="signup-password">Choose password</label>
                </div>
                <button class="btn purple darken-2 z-depth-0">Sign up</button>
            </form>
        </div>
    </div>
    <!-- Login Modal -->
    <div id="modal-login" class="modal">
        <div class="modal-content">
            <h4>Login</h4><br />
            <form id="login-form">
                <div class="input-field">
                    <input type="email" id="login-email" required />
                    <label for="login-email">Email address</label>
                </div>
                <div class="input-field">
                    <input type="password" id="login-password" required />
                    <label for="login-password">Your password</label>
                </div>
                <button class="btn purple darken-2 z-depth-0">Login</button>
            </form>
        </div>
    </div>

    <!-- Account Modal -->
    <div id="modal-account" class="modal">
        <div class="modal-content center-align">
            <h4>Account details</h4><br />
            <div class="account-details"></div>
        </div>
    </div>
    </div>

                <!-- div to display the generated registration token -->
                <div id="token_div" style="display: none;">
                  <h4>Registration Token</h4>
                  <p id="token" style="word-break: break-all;"></p>
                  <button class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored"
                          onclick="deleteToken()">Delete Token</button>
                </div>
                <!-- div to display the UI to allow the request for permission to
                     notify the user. This is shown if the app has not yet been
                     granted permission to notify. -->
                <div id="permission_div" style="display: flex;">
                  <p id="token"></p>
                  <button class="btn purple darken-2"
                          onclick="requestPermission()">Do you want to receive push notifications?</button>
                </div>
                <!-- div to display messages received by this app. -->
                <div id="messages"></div>
      <!--<script>
        // Retrieve Firebase Messaging object.
        const messaging = firebase.messaging();
      
        // IDs of divs that display registration token UI or request permission UI.
        const tokenDivId = 'token_div';
        const permissionDivId = 'permission_div';
      
        // Handle incoming messages. Called when:
        // - a message is received while the app has focus
        // - the user clicks on an app notification created by a service worker
        //   `messaging.onBackgroundMessage` handler.
        messaging.onMessage((payload) => {
          console.log('Message received. ', payload);
          // Update the UI to include the received message.
          appendMessage(payload);
        });
      
        function resetUI() {
          clearMessages();
          showToken('loading...');
          // Get registration token. Initially this makes a network call, once retrieved
          // subsequent calls to getToken will return from cache.
          messaging.getToken({vapidKey: 'BL74KfNDy9zWwIvsPCjfew03WqtUJCI62Zc4A2bIF-mdbpaEyjO0Bdb0QZLHvesW8txnjNYuiJEZVDA1k_N10q8'}).then((currentToken) => {
            if (currentToken) {
              sendTokenToServer(currentToken);
              updateUIForPushEnabled(currentToken);
            } else {
              // Show permission request.
              console.log('No registration token available. Request permission to generate one.');
              // Show permission UI.
              updateUIForPushPermissionRequired();
              setTokenSentToServer(false);
            }
          }).catch((err) => {
            console.log('An error occurred while retrieving token. ', err);
            showToken('Error retrieving registration token. ', err);
            setTokenSentToServer(false);
          });
        }
      
      
        function showToken(currentToken) {
          // Show token in console and UI.
          const tokenElement = document.querySelector('#token');
          tokenElement.textContent = currentToken;
        }
      
        // Send the registration token your application server, so that it can:
        // - send messages back to this app
        // - subscribe/unsubscribe the token from topics
        function sendTokenToServer(currentToken) {
          if (!isTokenSentToServer()) {
            console.log('Sending token to server...');
            // TODO(developer): Send the current token to your server.
            setTokenSentToServer(true);
          } else {
            console.log('Token already sent to server so won\'t send it again ' +
                'unless it changes');
          }
        }
      
        function isTokenSentToServer() {
          return window.localStorage.getItem('sentToServer') === '1';
        }
      
        function setTokenSentToServer(sent) {
          window.localStorage.setItem('sentToServer', sent ? '1' : '0');
        }
      
        function showHideDiv(divId, show) {
          const div = document.querySelector('#' + divId);
          if (show) {
            div.style = 'display: visible';
          } else {
            div.style = 'display: none';
          }
        }
      
        function requestPermission() {
          console.log('Requesting permission...');
          Notification.requestPermission().then((permission) => {
            if (permission === 'granted') {
              console.log('Notification permission granted.');
              // TODO(developer): Retrieve a registration token for use with FCM.
              // In many cases once an app has been granted notification permission,
              // it should update its UI reflecting this.
              resetUI();
            } else {
              console.log('Unable to get permission to notify.');
            }
          });
        }
      
        function deleteToken() {
          // Delete registration token.
          messaging.getToken().then((currentToken) => {
            messaging.deleteToken(currentToken).then(() => {
              console.log('Token deleted.');
              setTokenSentToServer(false);
              // Once token is deleted update UI.
              resetUI();
            }).catch((err) => {
              console.log('Unable to delete token. ', err);
            });
          }).catch((err) => {
            console.log('Error retrieving registration token. ', err);
            showToken('Error retrieving registration token. ', err);
          });
        }
      
        // Add a message to the messages element.
        function appendMessage(payload) {
          const messagesElement = document.querySelector('#messages');
          const dataHeaderElement = document.createElement('h5');
          const dataElement = document.createElement('pre');
          dataElement.style = 'overflow-x:hidden;';
          dataHeaderElement.textContent = 'Received message:';
          dataElement.textContent = JSON.stringify(payload, null, 2);
          messagesElement.appendChild(dataHeaderElement);
          messagesElement.appendChild(dataElement);
        }
      
        // Clear the messages element of all children.
        function clearMessages() {
          const messagesElement = document.querySelector('#messages');
          while (messagesElement.hasChildNodes()) {
            messagesElement.removeChild(messagesElement.lastChild);
          }
        }
      
        function updateUIForPushEnabled(currentToken) {
          showHideDiv(tokenDivId, true);
          showHideDiv(permissionDivId, false);
          showToken(currentToken);
        }
      
        function updateUIForPushPermissionRequired() {
          showHideDiv(tokenDivId, false);
          showHideDiv(permissionDivId, true);
        }
      
        resetUI();
        </script>-->

    <script src="./js/ui.js"></script>
    <script src="./js/app.js"></script>
    <script type="module" src="./js/pushnotification.js"></script>
    <script type="module" src="./js/db.js"></script>
    <script type="module" src="./js/auth.js"></script>
</body>

</html>